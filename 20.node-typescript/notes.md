To use TypeScript with Node.js effectively, we need to focus on the fundamentals of TypeScript and how it integrates with Node.js. Below is a detailed guide:

---

## **What is TypeScript?**
TypeScript is a superset of JavaScript that adds **static typing**. This allows us to catch errors during development rather than at runtime.

---

### **1. TypeScript Basics**

#### **a. Types**
Types ensure variables hold specific kinds of values.

```typescript
// Primitive types
let id: number = 42;
let username: string = "Skyy";
let isActive: boolean = true;

// Arrays
let numbers: number[] = [1, 2, 3];

// Tuples
let user: [number, string] = [1, "Skyy"]; // Fixed length and types

// Enums
enum Status {
  Active,
  Inactive,
  Pending,
}
let currentStatus: Status = Status.Active;

// Any (use sparingly)
let randomValue: any = "Hello"; // Can hold any type
```

#### **b. Interfaces**
Used to define the shape of objects.

```typescript
interface User {
  id: number;
  name: string;
}

const newUser: User = {
  id: 1,
  name: "Skyy",
};
```

#### **c. Functions**
Adding type annotations to function parameters and return values.

```typescript
function add(a: number, b: number): number {
  return a + b;
}

// Optional and default parameters
function greet(name: string, age?: number): string {
  return `Hello, ${name}${age ? `, age: ${age}` : ""}`;
}
```

#### **d. Type Aliases**
Similar to interfaces but more flexible.

```typescript
type ID = string | number;
let userId: ID = 123;
```

---

### **2. Setting Up TypeScript with Node.js**

#### **a. Initialize TypeScript**
1. Install TypeScript globally:
   ```bash
   npm install -g typescript
   ```
2. Create a `tsconfig.json` file:
   ```bash
   tsc --init
   ```
   Key configurations:
   ```json
   {
     "target": "ES6", // Compile to ES6 JavaScript
     "module": "CommonJS", // Use Node.js modules
     "outDir": "./dist", // Output directory for compiled files
     "rootDir": "./src", // Source files directory
     "strict": true // Enable strict type checking
   }
   ```

#### **b. Install Node.js Type Definitions**
To use Node.js libraries, install their type definitions:
```bash
npm install --save-dev @types/node
```

---

### **3. Writing Node.js with TypeScript**

#### **a. Basic Setup**
Structure:
```
project/
│
├── src/
│   └── index.ts
├── dist/  (generated by TypeScript)
├── package.json
├── tsconfig.json
└── node_modules/
```

Example `src/index.ts`:
```typescript
import http from "http";

const server = http.createServer((req, res) => {
  res.writeHead(200, { "Content-Type": "text/plain" });
  res.end("Hello, TypeScript with Node.js!");
});

server.listen(3000, () => {
  console.log("Server running at http://localhost:3000/");
});
```

Compile and run:
```bash
tsc
node dist/index.js
```

#### **b. Using Modules**
Example: Create a module `src/utils.ts`.

```typescript
export const multiply = (a: number, b: number): number => a * b;
```

Import it in `index.ts`:
```typescript
import { multiply } from "./utils";

console.log(multiply(2, 3)); // Outputs: 6
```

---

### **4. Advanced TypeScript Features**

#### **a. Generics**
Reusable components for different types.

```typescript
function identity<T>(value: T): T {
  return value;
}

console.log(identity<string>("Skyy")); // "Skyy"
console.log(identity<number>(42)); // 42
```

#### **b. Classes**
Defining classes with TypeScript.

```typescript
class Animal {
  name: string;

  constructor(name: string) {
    this.name = name;
  }

  speak(): void {
    console.log(`${this.name} makes a noise.`);
  }
}

class Dog extends Animal {
  speak(): void {
    console.log(`${this.name} barks.`);
  }
}

const dog = new Dog("Buddy");
dog.speak(); // "Buddy barks."
```

#### **c. Decorators**
Meta-programming features (advanced).

```typescript
function Logger(target: any, key: string): void {
  console.log(`${key} was accessed`);
}

class Example {
  @Logger
  print(): void {
    console.log("Printing...");
  }
}
```

---

### **5. Debugging and Running**
Use `ts-node` for easier development:
```bash
npm install --save-dev ts-node
```
Run directly:
```bash
npx ts-node src/index.ts
```

---

### **6. Additional Tools**

#### **a. ESLint and Prettier**
For linting and formatting.
```bash
npm install --save-dev eslint prettier
```

#### **b. Testing with Jest**
TypeScript-friendly testing.
```bash
npm install --save-dev jest @types/jest ts-jest
```

---
Let's dive into building a **Node.js/Express.js REST API** with TypeScript. Here's a step-by-step guide to create a robust and well-structured API:

---

### **Step 1: Set Up the Project**
1. **Initialize the Project:**
   ```bash
   mkdir rest-api-ts
   cd rest-api-ts
   npm init -y
   ```

2. **Install Dependencies:**
   ```bash
   npm install express
   npm install --save-dev typescript @types/node @types/express ts-node nodemon
   ```

3. **Initialize TypeScript:**
   ```bash
   npx tsc --init
   ```
   Update `tsconfig.json`:
   ```json
   {
     "compilerOptions": {
       "target": "ES6",
       "module": "CommonJS",
       "rootDir": "./src",
       "outDir": "./dist",
       "strict": true,
       "esModuleInterop": true,
       "skipLibCheck": true
     },
     "include": ["src/**/*"]
   }
   ```

4. **Set Up Scripts in `package.json`:**
   ```json
   "scripts": {
     "build": "tsc",
     "start": "node dist/index.js",
     "dev": "nodemon src/index.ts"
   }
   ```

---

### **Step 2: Create the Project Structure**
Project Layout:
```
rest-api-ts/
├── src/
│   ├── routes/
│   │   └── user.routes.ts
│   ├── controllers/
│   │   └── user.controller.ts
│   ├── models/
│   │   └── user.model.ts
│   ├── middlewares/
│   │   └── error.middleware.ts
│   ├── utils/
│   │   └── logger.ts
│   ├── index.ts
├── tsconfig.json
├── package.json
```

---

### **Step 3: Build the API**

#### **1. Entry Point (`index.ts`):**
Set up the Express server.

```typescript
import express, { Application } from "express";
import userRoutes from "./routes/user.routes";
import { errorHandler } from "./middlewares/error.middleware";

const app: Application = express();
const PORT = process.env.PORT || 3000;

// Middleware
app.use(express.json());

// Routes
app.use("/api/users", userRoutes);

// Error Handling Middleware
app.use(errorHandler);

// Start Server
app.listen(PORT, () => {
  console.log(`Server running on http://localhost:${PORT}`);
});
```

---

#### **2. Routes (`user.routes.ts`):**
Define API endpoints.

```typescript
import { Router } from "express";
import { getUsers, createUser } from "../controllers/user.controller";

const router: Router = Router();

router.get("/", getUsers); // GET /api/users
router.post("/", createUser); // POST /api/users

export default router;
```

---

#### **3. Controllers (`user.controller.ts`):**
Handle request logic.

```typescript
import { Request, Response } from "express";
import { User } from "../models/user.model";

// Mock database
const users: User[] = [];

export const getUsers = (req: Request, res: Response): void => {
  res.status(200).json({ success: true, data: users });
};

export const createUser = (req: Request, res: Response): void => {
  const { name, email } = req.body;

  if (!name || !email) {
    res.status(400).json({ success: false, message: "Name and Email are required" });
    return;
  }

  const newUser: User = { id: Date.now(), name, email };
  users.push(newUser);

  res.status(201).json({ success: true, data: newUser });
};
```

---

#### **4. Models (`user.model.ts`):**
Define the shape of the data.

```typescript
export interface User {
  id: number;
  name: string;
  email: string;
}
```

---

#### **5. Middleware (`error.middleware.ts`):**
Centralize error handling.

```typescript
import { Request, Response, NextFunction } from "express";

export const errorHandler = (
  err: Error,
  req: Request,
  res: Response,
  next: NextFunction
): void => {
  console.error(err.stack);
  res.status(500).json({ success: false, message: "Server Error" });
};
```

---

#### **6. Utilities (`logger.ts`):**
Utility for logging.

```typescript
export const log = (message: string): void => {
  console.log(`[LOG]: ${message}`);
};
```

---

### **Step 4: Test the API**

1. Start the server:
   ```bash
   npm run dev
   ```

2. Test endpoints using Postman or curl:
   - **GET `/api/users`**:
     ```bash
     curl http://localhost:3000/api/users
     ```
   - **POST `/api/users`**:
     ```bash
     curl -X POST http://localhost:3000/api/users \
     -H "Content-Type: application/json" \
     -d '{"name": "Skyy", "email": "skyy@example.com"}'
     ```

---

### **Step 5: Add Advanced Features**

#### **1. Environment Variables:**
Secure sensitive data using `dotenv`.

```bash
npm install dotenv
```

Setup `.env`:
```
PORT=3000
```

Load it in `index.ts`:
```typescript
import dotenv from "dotenv";
dotenv.config();
```

#### **2. Database Integration:**
Use MongoDB with Mongoose.
```bash
npm install mongoose
npm install --save-dev @types/mongoose
```

Example:
```typescript
import mongoose from "mongoose";

mongoose
  .connect(process.env.MONGO_URI!)
  .then(() => console.log("Connected to MongoDB"))
  .catch((err) => console.error("MongoDB connection error:", err));
```

#### **3. Request Validation:**
Use `zod` or `express-validator` for input validation.
```bash
npm install zod
```

Example:
```typescript
import { z } from "zod";

const userSchema = z.object({
  name: z.string(),
  email: z.string().email(),
});

export const validateUser = (data: unknown) => userSchema.parse(data);
```

---

### **Next Steps:**
- Implement authentication using `jsonwebtoken` or OAuth.
- Add testing using tools like Jest or Supertest.
- Deploy the API on platforms like Heroku or AWS.
